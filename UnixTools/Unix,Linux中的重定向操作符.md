### 背景知识：

在 Linux 系统中，程序的输入输出流可以分为以下三种：

1. **标准输入（stdin）**：用于接收输入，文件描述符为 `0`，通常是键盘输入。
2. **标准输出（stdout）**：用于输出正常的程序结果，文件描述符为 `1`，通常显示在终端。
3. **标准错误（stderr）**：用于输出错误信息，文件描述符为 `2`，也通常显示在终端。

通常情况下，标准输出和标准错误是分开的，例如：

- 正常输出（`stdout`）可能会通过管道传给下一个命令。
- 错误信息（`stderr`）则直接显示在终端上，不会通过管道传递。





#### `stdout`与`stderr`

通常，程序会遵循以下规则来决定信息输出到 `stdout` 还是 `stderr`：

1. **正常工作结果**（如命令的成功输出）发送到 `stdout`。

2. **错误、警告、异常等信息**

    发送到 `stderr`

   - 这类信息通常不代表程序的核心功能的输出，而是用来告知用户可能的问题或不正常的状态。

3. **用户输入提示**（如输入密码等）有时也会通过 `stderr` 发送，以确保在标准输出被重定向时仍能显示提示信息。











### 重定向的原理：



#### 重定向

重定向可以将某个输出流重定向到另一个地方。常用符号有：

- `>`：重定向输出。等同于`1>`

  * 重定向标准输出

    这个命令会将 `./a.out` 的标准输出（`stdout`）写入 `file.txt` 文件。原先显示在终端的输出现在会写入文件。

    如果 `file.txt` 已经存在，它的内容会被覆盖。

    ```bash
    ./a.out > file.txt
    ```

  * 重定向标准输出追加到文件

    ```bash
    ./a.out >> file.txt
    ```

- `2>`：重定向标准错误（`stderr`）。

  重定向与重定向追加

  ```bash
  command 2> error.txt
  command 2>> error.txt
  ```

  

- `&`：表示文件描述符。

当你写 `2>&1` 时，逻辑如下：

- `2` 代表标准错误输出（`stderr`，文件描述符 2）。

- `&1` 表示标准输出（`stdout`，文件描述符 1）。

  在重定向中，`&` 是一个特殊符号，用来指定**文件描述符**。在 `2>&1` 中，`&` 告诉 Shell，`2`（标准错误）应被重定向到另一个文件描述符 `1`（标准输出），而不是重定向到文件名。如果不加 `&`，如写作 `2>1`，Shell 会将标准错误输出重定向到一个名为 `1` 的文件，而不是标准输出。

  - `2>&1` 的解释：
    - `2` 代表标准错误（`stderr`，文件描述符 `2`）。
    - `&1` 告诉系统，标准错误流（`stderr`）重定向到文件描述符 `1`，即标准输出流（`stdout`）。





**整体意思**：将标准错误（`stderr`）重定向到标准输出（`stdout`）。换句话说，错误信息将与正常输出信息一起通过标准输出流传递。



**命令顺序的区别**

```bash
command 2>&1 > output.txt
command > output.txt 2>&1
```

前者

* `2>&1` 先将标准错误重定向到**当前的标准输出**（即默认输出，通常是终端）。

* 然后 `> output.txt` 将标准输出重定向到 `output.txt` 文件。

后者

* `> output.txt` 先将**标准输出**重定向到 `output.txt` 文件。

* 然后，`2>&1` 将**标准错误**重定向到**标准输出**，不过此时标准输出已经被重定向到 `output.txt` 文件了，所以**标准错误**的内容也会进入 `output.txt`。











### 一个例子

考虑`strace -T ./a.out | vim -`会输出什么？

> 这个操作会将./a.out的输出输出到vim,而strace的输出输出到终端。
>
> 因为认为a.out的输出是stdout，strace的输出是stderr
>
> vim默认读取stdin，管道是将stdout转换成stdin

这个时候，如果我们想将strace的输出通过管道给vim，而非a.out的输出，该怎么办？

#### 具体操作：

在命令 `strace -T ./a.out 2>&1 | vim -` 中：

1. **`strace -T ./a.out`**：
   - `./a.out` 的标准输出通过 `stdout` 输出。
   - `strace` 生成的系统调用跟踪信息通过 `stderr` 输出。
2. **`2>&1`**：
   - 将 `stderr`（strace 的跟踪输出）重定向到 `stdout`，也就是现在所有的输出都变成了标准输出。
3. **`| vim -`**：
   - `vim -` 通过管道从标准输入中读取数据，由于 `stderr` 被重定向到 `stdout`，现在 `vim` 能够接收到 `strace` 的跟踪信息和 `./a.out` 的标准输出，一并显示在编辑器中。

#### 管道与重定向的区别和结合：

- **管道 (`|`)**：通常只传递前一个命令的标准输出（`stdout`）到下一个命令的标准输入（`stdin`）。
- **重定向 (`2>&1`)**：允许你将标准错误输出和标准输出合并，从而通过管道一并传递。



`2>&1` 是标准输入输出和重定向的高级用法之一，它允许你在使用管道时，不仅传递标准输出（`stdout`），还可以将错误信息（`stderr`）一并传递。