## 1. 性能限制来自哪里

### 性能限制概览

在并行和高性能计算中，真正的性能限制并不完全是浮点运算速度，最关键的是**带宽和延迟**。

#### 1. 带宽 (Bandwidth)

- **定义**：带宽是数据通过系统中给定路径进行移动的最佳速率。
- **重要性**：由于带宽的限制，==在编写代码时应该使用数据流算法，并尽可能使用连续的内存空间==。

#### 2. 延迟 (Latency)

- **定义**：延迟指的是传输第一个字节或字符所需的时间。
- **考虑点**：当无法使用流式算法时，延迟将成为主要的性能瓶颈。值得注意的是，未使用流式处理的应用程序，其延迟时间可能比带宽慢了几个数量级。

#### 3. 其他硬件性能限制

- **Flop**
  - **定义**：Flop（浮点运算）表示计算机在一秒内可以执行的浮点操作次数。
  - **原因**：处理器的计算能力有限，当计算需求超过处理器的能力时，Flop成为瓶颈。
- **Ops（所有类型的计算机指令）**
  - **定义**：Ops表示计算机可以执行的所有类型的计算机指令。
  - **原因**：与Flop类似，但涵盖了所有类型的计算操作，不仅仅是浮点运算。
- **内存带宽**
  - **定义**：内存带宽表示在**特定时间内可以从内存传输到CPU的数据量**。
  - **原因**：当处理大量数据或并行处理数据时，内存带宽可能成为瓶颈。

- **内存延迟**
  - **定义**：内存延迟是从**CPU请求数据到数据从内存到达CPU所需的时间**。
  - **原因**：高内存延迟会导致CPU等待，降低整体性能。
- **指令队列（指令缓存）**
  - **定义**：指令缓存用于暂存近期使用的指令，以减少从主内存获取指令的延迟。
  - **原因**：**如果指令缓存太小或者效率不高，CPU可能需要频繁地从主内存获取指令**，导致性能下降。
- **网络**
  - **定义**：涉及到数据在计算机或计算机之间的传输。
  - **原因**：网络带宽或延迟可能限制分布式系统或云计算的性能。
- **磁盘**
  - **定义**：磁盘I/O涉及数据的读取和写入。
  - **原因**：磁盘速度远低于内存和CPU，所以I/O操作可能成为性能瓶颈。

### 性能限制分类

我们可以将所有这些限制分为两大类：

- **速度 (Speed)**：主要关注操作的执行速度。
- **数据供给 (Data Supply)**：关注为所需的操作提供数据。数据供给包括因素如内存带宽、网络等。



## 2. 性能限制可以通过哪些方法处理

### 数据获取与传输

虽然最直接的性能优化方法是使用更深层次的缓存（如L1缓存），但在实际工作中，往往需要从硬盘和网络获取大量数据，而这些数据传输所需的时间往往是一个关键的性能瓶颈。

### 算术强度

算术强度是衡量应用程序的指标，其目的是为了测量每次内存操作后执行的浮点运算次数。单位常见为8字节/次（double）或4字节/次（float）。大多数应用程序的算术强度接近于每加载一个字节进行一次浮点运算。但是，使用密集矩阵求解器来求解的Linpack benchmark的算术强度可以高达62.5flop/字。因此，Linpack已经成为设计当前机器时，以高浮点操作与内存负载比为主的关键因素。

### 内存带宽的利用率

不是所有应用程序都能充分利用内存带宽。考虑一个按行存储的二维数据结构，如果我们只访问其中一列，那么由于内存的跨行不连续访问，实际上只使用了1/8的内存带宽。

我们根据缓存使用百分比$U_{cache}$和实证带宽$B_E$来定义非连续带宽$B_{nc}$，**$B_{nc} = U_{cache}\times B_E = 平均缓存使用百分比\times 实证带宽$**

### 其他实际工作中的问题

1. **指令缓存延迟**：如果指令缓存不能及时加载指令，那么处理器核心可能无法保持其最大运算速度。这通常是由于指令流中的分支或缓存未命中引起的。这意味着处理器虽然还有能力处理更多的任务，但由于等待指令而未充分利用
2. **整数运算与复杂索引计算**：除浮点运算外，整数运算和索引计算也可能成为性能瓶颈，特别是在涉及复杂数据结构访问或条件判断时。



## 3. 基准测试





## 4. 性能分析







